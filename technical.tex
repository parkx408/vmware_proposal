% technical.tex
\section{Proposed Architecture}
\label{sec:technical}
% 
\begin{figure}[t]
\centering
\input{archfig}
\caption{Overview of Proposed Architecture. The blue modules are implemented in \emph{Virtual Center} server and has global view of the entire system. The red modules are implemented in the \emph{ESXi} server and have the local host view.}
\label{arch}
\end{figure}

\subsection{Resource Management Mechanism}

There are three ways to allocate resources to a VM. 
The simplest approach is through VM configuration. 
However, this approach typically requires a reboot of the VMs and will not be the focus of our proposal. 

The second approach is through \emph{entitlement} control.
It is shown as \emph{Resource Entitlement} in Figure \ref{arch}.
The term entitlement refers to the resource scheduling priority in the case where multiple VMs compete for the same resource\cite{}.
By giving a higher entitlement of resources to a VM, the effect of consolidation can be minimized.
This approach is especially effective in the case of over-provisioning.
The limitation of this method is that the VM is confined to the physical resources of the host. 

The third approach is through \emph{live migration}. 
It is shown as \emph{Resource Map} in Figure \ref{arch}.
By relocating VMs onto a more available and powerful hardware, a VM can potentially access any physical resource available in the system. 
Note that the storage resources are typically a separate entity from the host and requires separate migration path. 
Therefore, we assume all hosts and storage nodes are fully connected. 

These approaches determine how the virtual resources are mapped to the physical resources and their relationship is shown in Figure \ref{arch}.

\subsection{Resource Management Policy}

The resource management policy is enforced by the \emph{Policy Manager}. 
There are two types of policies, VM policies and application policies. 

The VM policy is a mandatory policy that must be specified when a VM is created. 
These policies include things like number of CPUs, size of the memory and \emph{entitlement} of these resources. 

The application policy is an optional policy set to provide a particular application a performance guarantee. 
A given application policy has a higher priority than the VM policy and may override the VM policies if necessary. 
If the dynamic resource management mechanisms cannot satisfy the policy, the \emph{Virtual Center} server may issue a warning and recommend that the VM be reconfigured which requires reboot of the VM. 

To ensure that the policies are met and also likely to be met in the future, current system states are continuously monitored. 
Resource monitor checks for the health status of the physical resources as well as addition of new resources. 
VM monitor check for the health of the VMs as well as their current performance and resource requirements. 
Application monitor collects the application performance statistics and requires support from the guest OS. 

Given the polcies and monitored information, policy manager decides how the resource mapping and entitlements should be configured. 
This will be the focus of our work.
To determine what mapping and entitlements will satisfy the policy with minimum resources, we must be able to predict the performance after the changes. 
We propose to use statistical inference techniques to model the VM level and/or application level performances based on the workload and the resources provided. 
The modeling framework will first extract the characteristics from the workload such that the extracted characteristics have high correlation with the performance. 
These characteristics than will be regressed agains the performance inder various resource configuration to determine the performance model. 
